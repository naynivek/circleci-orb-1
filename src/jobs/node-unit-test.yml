description: >
  Testing node applications with yarn test:nowatch

executor: default

docker:
  - image: circleci/<< parameters.image >>

parameters:
  image:
    type: string
    default: "node:10.16.0-browsers"
    description: "Node image"

steps:
  - checkout
  - restore_cache:
      keys:
        - v1-dependencies-{{ checksum "package.json" }}
        # fallback to using the latest cache if no exact match is found
        - v1-dependencies-
  - run: cat /dev/null | yarn install
  - run: cat /dev/null | yarn test:nowatch
  - store_artifacts:
      path: coverage
      destination: coverage-report
  - save_cache:
      key: v1-dependencies-{{ checksum "package.json" }}
      paths:
        - "./node_modules"
  - persist_to_workspace:
      paths:
        - ./*
